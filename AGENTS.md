# AGENTS.md — Руководство для AI-агентов

> Полное руководство по работе с шаблоном русской кандидатской диссертации на Typst

---

## Общая информация

| Параметр       | Значение                                                      |
| -------------- | ------------------------------------------------------------- |
| **Название**   | `modern-russian-dissertation`                                 |
| **Версия**     | 0.0.1                                                         |
| **Компилятор** | Typst 0.11.0+                                                 |
| **Лицензия**   | MIT                                                           |
| **Назначение** | Шаблон русской кандидатской диссертации по ГОСТ Р 7.0.11-2011 |

---

## Структура проекта

```
├── thesis.typ              # Главный файл (точка входа)
├── lib.typ                 # Библиотека функций и шаблон
├── glossarium.typ          # Модуль глоссария (локальная копия)
├── typst.toml              # Конфигурация пакета
├── README.md               # Документация
├── AGENTS.md               # Это руководство
│
├── common/                 # Данные диссертации
│   ├── acronyms.typ        # Список сокращений
│   ├── glossary.typ        # Словарь терминов
│   ├── symbols.typ         # Условные обозначения
│   ├── author.bib          # Публикации автора
│   └── external.bib        # Внешняя библиография
│
├── parts/                  # Части диссертации
│   ├── intro.typ           # Введение
│   ├── part1.typ           # Глава 1
│   ├── part2.typ           # Глава 2
│   ├── part3.typ           # Глава 3
│   ├── conclusion.typ      # Заключение
│   └── appendix.typ        # Приложения
│
└── images/                 # Изображения
    ├── logo.svg            # Логотип организации
    └── ...                 # Другие изображения
```

---

## Детальное описание файлов

### `thesis.typ` — Главный файл

**Назначение:** Точка входа, собирает все части диссертации

**Структура:**

1. Импорт библиотеки `lib.typ`
2. Применение шаблона `template.with(...)` с настройками
3. Подключение частей документа через `#include`
4. Генерация выходных данных (глоссарии, библиография, списки)

**Пример:**

```typst
#import "lib.typ": *
#show: template.with(
  languages: (rust: icon(image("images/brand-rust.svg"))),
  logo: image("images/logo.svg", width: 2.5cm)
)

#include "./parts/intro.typ"
#include "./parts/part1.typ"
// ...

#print-glossary(acronyms-entries + symbols-entries)
#bibliography(("./common/external.bib", "./common/author.bib"), style: "gost-r-705-2008-numeric")
```

---

### `lib.typ` — Библиотека функций

**Назначение:** Основная библиотека с шаблоном и вспомогательными функциями

#### Импортируемые пакеты

| Пакет                    | Назначение                   |
| ------------------------ | ---------------------------- |
| `@preview/unify:0.5.0`   | Работа с единицами измерения |
| `@preview/tablex:0.0.8`  | Расширенные таблицы          |
| `@preview/physica:0.9.3` | Физические формулы           |
| `glossarium.typ`         | Локальный модуль глоссария   |

#### Глобальные счётчики

| Переменная       | Назначение             | Использование                       |
| ---------------- | ---------------------- | ----------------------------------- |
| `part_count`     | Счётчик глав           | `#part_count.step()` в начале главы |
| `total_part`     | Общее число глав       | Автоматически во введении           |
| `appendix_count` | Счётчик приложений     | Автоматически                       |
| `total_appendix` | Общее число приложений | Автоматически во введении           |
| `total_page`     | Общее число страниц    | Автоматически во введении           |
| `total_fig`      | Общее число рисунков   | Автоматически во введении           |
| `total_table`    | Общее число таблиц     | Автоматически во введении           |
| `total_bib`      | Общее число источников | Автоматически во введении           |

#### Параметры функции `template(...)`

| Параметр            | Тип     | По умолчанию      | Описание                     |
| ------------------- | ------- | ----------------- | ---------------------------- |
| `author-first-name` | str     | "Иван Иванович"   | Имя и отчество автора        |
| `author-last-name`  | str     | "Иванов"          | Фамилия автора               |
| `author-initials`   | str     | "И.И."            | Инициалы                     |
| `title`             | str     | "Название..."     | Название диссертации         |
| `udk`               | str     | "000.00"          | УДК классификатор            |
| `specialty-number`  | str     | "0.0.0"           | Номер специальности          |
| `specialty-title`   | str     | "Название..."     | Название специальности       |
| `degree`            | str     | "кандидата..."    | Учёная степень (полная)      |
| `degree-short`      | str     | "канд...."        | Учёная степень (сокращённая) |
| `city`              | str     | "Город"           | Город                        |
| `year`              | int     | 2024              | Год                          |
| `organization`      | content | [...]             | Название организации         |
| `supervisor-*`      | str     | [...]             | Данные научного руководителя |
| `font-type`         | str     | "Times New Roman" | Шрифт                        |
| `font-size`         | length  | 14pt              | Размер шрифта                |
| `link-color`        | color   | black             | Цвет ссылок                  |
| `languages`         | dict    | (:)               | Языки для листингов кода     |
| `logo`              | content | none              | Логотип организации          |

#### Вспомогательные функции

| Функция              | Описание                      | Пример                    |
| -------------------- | ----------------------------- | ------------------------- |
| `ident-par(it)`      | Отступ первого абзаца раздела | `#ident-par[Текст...]`    |
| `phd-appendix(body)` | Режим приложений (A, B, C...) | `#show: phd-appendix`     |
| `icon(image)`        | Иконка для листингов          | `icon(image("icon.svg"))` |

---

### `glossarium.typ` — Модуль глоссария

**Назначение:** Система управления глоссарием, сокращениями и символами

**Источник:** Адаптирован из `ENIB-Community/glossarium`

#### Основные функции

| Функция                        | Описание                           | Пример                    |
| ------------------------------ | ---------------------------------- | ------------------------- |
| `gls(key, long, display)`      | Ссылка на термин/сокращение        | `#gls("si")`              |
| `sym(key)`                     | Ссылка на символ                   | `#sym("pi")`              |
| `print-eq-sym(...keys)`        | Расшифровка символов после формулы | `#print-eq-sym("a", "b")` |
| `make-glossary(body)`          | Show-правило для обработки ссылок  | Автоматически в lib.typ   |
| `print-glossary(entries, ...)` | Печать глоссария                   | В thesis.typ              |

#### Формат записей глоссария

**Сокращения (`common/acronyms.typ`):**

```typst
#let acronyms-entries = {(
  (key: "si", short: "СИ", long: "Система интернациональная"),
  (key: "ацп", short: "АЦП", long: "Аналого-Цифровой Преобразователь"),
)}
```

**Символы (`common/symbols.typ`):**

```typst
#import "@preview/unify:0.5.0": *
#let symbols-entries = {(
  (key: "pi", short: [$pi$], long: [Число $pi$]),
  (key: "a", short: [$a$], long: [Число $a$], desc: [#unit("cm/s")]),
)}
```

**Термины (`common/glossary.typ`):**

```typst
#let glossary-entries = {(
  (key: "typst", short: "Typst", desc: "Новая система набора текста..."),
)}
```

---

## Связи между файлами

```
thesis.typ
    │
    ├── import lib.typ
    │       ├── import @preview/unify
    │       ├── import @preview/tablex
    │       ├── import @preview/physica
    │       └── import glossarium.typ
    │
    ├── include parts/intro.typ ──────┐
    ├── include parts/part1.typ ──────┤
    ├── include parts/part2.typ ──────┼── import lib.typ
    ├── include parts/part3.typ ──────┤
    ├── include parts/appendix.typ ───┘
    ├── include parts/conclusion.typ
    │
    ├── import common/acronyms.typ
    ├── import common/symbols.typ
    ├── import common/glossary.typ
    │
    └── bibliography(common/external.bib, common/author.bib)
```

---

## Правила ГОСТ-оформления

| Элемент            | Значение                           | ГОСТ                    |
| ------------------ | ---------------------------------- | ----------------------- |
| Шрифт              | Times New Roman, 14pt              | ГОСТ 7.0.11-2011, 5.3   |
| Поля               | 2/2/2.5/1 см (верх/низ/лево/право) | ГОСТ 7.0.11-2011, 5.3.7 |
| Абзацный отступ    | 2.5em (≈5 знаков)                  | ГОСТ 7.0.11-2011, 5.3.7 |
| Интервал           | Полуторный                         | ГОСТ 7.0.11-2011, 5.3.6 |
| Отступы заголовков | 3em сверху и снизу                 | ГОСТ 7.0.11-2011, 5.3.5 |
| Библиография       | gost-r-705-2008-numeric            | ГОСТ Р 7.0.5-2008       |
| Нумерация страниц  | Сверху, по центру                  | ГОСТ                    |

---

## Примеры использования

### Ссылки в тексте

```typst
// Библиография
@Sokolov                    // → [1]

// Разделы
@ch1                        // → Глава 1
@ch2:sec1                   // → Раздел 2.1

// Приложения
@app:A                      // → Приложение A

// Формулы
@eq:equation1               // → (1.1)

// Рисунки и таблицы
@fig:typst                  // → Рисунок 1.1
@t1                         // → Таблица 3.1

// Глоссарий
@typst                      // → Typst (термин)
@si                         // → СИ (сокращение)
@pi                         // → π (символ)
```

### Структура главы

```typst
#part_count.step()  // ОБЯЗАТЕЛЬНО в начале каждой главы!

= Название главы <ch1>

== Первый раздел <ch1:sec1>

#ident-par[
  Первый абзац с отступом...
]

Последующие абзацы без явного отступа...
```

### Формулы с расшифровкой

```typst
$ a = b + c $ <eq:example>

#print-eq-sym("a", "b", "c")
// Выведет: где a — ...; b — ...; c — ...
```

### Рисунки

```typst
#figure(
  image("images/example.png", width: 80%),
  caption: [Описание изображения]
) <fig:example>
```

### Таблицы

```typst
#figure(
  table(
    columns: 3,
    [Колонка 1], [Колонка 2], [Колонка 3],
    [Данные], [Данные], [Данные],
  ),
  caption: [Описание таблицы]
) <t:example>
```

### Приложения

````typst
// В parts/appendix.typ
#show: phd-appendix  // Включает нумерацию A, B, C...

= Первое приложение <app:A>

// Листинг кода
#figure(
  ```rust
  fn main() {
      println!("Hello, world!");
  }
  ```,
  caption: [Пример кода на Rust]
)
````

---

## Команды компиляции

```bash
# Однократная компиляция
typst compile thesis.typ

# Режим отслеживания изменений (рекомендуется)
typst watch thesis.typ

# Инициализация нового проекта из шаблона
typst init @preview/modern-russian-dissertation
```

---

## Добавление нового контента

### Новая глава

1. Создать файл `parts/part4.typ`:

```typst
#import "../lib.typ": *

#part_count.step()

= Название новой главы <ch4>

#ident-par[
  Содержание главы...
]
```

2. Добавить в `thesis.typ`:

```typst
#include "./parts/part4.typ"
```

### Новое сокращение

Добавить в `common/acronyms.typ`:

```typst
(key: "новый_ключ", short: "СОКР", long: "Полная расшифровка"),
```

### Новый символ

Добавить в `common/symbols.typ`:

```typst
(key: "новый_символ", short: [$x$], long: [Описание символа], desc: [#unit("m/s")]),
```

### Новый источник

Добавить в `common/external.bib` (внешний) или `common/author.bib` (собственные публикации):

```bibtex
@article{NewSource2024,
  author = {Автор, И. О.},
  title = {Название статьи},
  journal = {Журнал},
  year = {2024},
  volume = {1},
  pages = {1--10},
}
```

---

## Известные ограничения

1. **Отключённые пакеты:**
   - `codly` — несовместим с текущей версией Typst
   - `indenta` (`fix-indent`) — несовместим с текущей версией Typst

2. **Требования:**
   - Typst версии 0.11.0 или выше
   - Шрифт Times New Roman в системе

---

## Контрольный список перед компиляцией

- [ ] Все главы начинаются с `#part_count.step()`
- [ ] Все метки уникальны (`<ch1>`, `<fig:example>`, и т.д.)
- [ ] Все ссылки на источники существуют в `.bib` файлах
- [ ] Изображения находятся в папке `images/`
- [ ] Параметры шаблона в `thesis.typ` заполнены корректно
